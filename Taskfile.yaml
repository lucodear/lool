# https://taskfile.dev

version: '3'

tasks:
  run:watch:
    desc: ðŸš€ watch lool
    cmds:
      - cargo watch -c -x "run -- --version"

  build:watch:
    desc: ðŸš€ watch lool Â«buildÂ»
    cmds:
      - cargo watch -c -x "build"

  build:
    desc: âš¡ build lool Â«releaseÂ»
    cmds:
      - cargo build --release
      - python check_size.py

  example:logger:
    desc: ðŸš€ run lool Â«example loggerÂ»
    cmds:
      - cargo run --example=logger --release --features logger
  
  example:threadpool:
    desc: ðŸš€ run lool Â«example threadpoolÂ»
    cmds:
      - cargo run --example=threadpool --release --features utils.threads

  example:gridselector:
    desc: ðŸš€ run lool Â«example widget_grid_selectorÂ»
    cmds:
      - cargo watch --features=cli.tui.widgets,tokio.rt -c -x "run --example widget_grid_selector"

  example:switch:
    desc: ðŸš€ run lool Â«example widget_switchÂ»
    cmds:
      - cargo watch --features=cli.tui.widgets,tokio.rt -c -x "run --example widget_switch"

  fmt:
    desc: ðŸŽ¨ format lool
    cmds:
      - cargo +nightly fmt --all

  fmt:check:
    desc: ðŸŽ¨ check format
    cmds:
        - cargo +nightly fmt --all --check

  lint:
    desc: ðŸ§¶ lint lool
    cmds:
      - cargo clippy --fix --all-features --allow-staged

  lint:check:
    desc: ðŸ§¶ check linting
    cmds:
        - cargo clippy --all-features

  fmt+lint:
    desc: ðŸŽ¨ðŸ§¶ format and lint rustler
    cmds:
        - task fmt
        - git add .
        - task lint

  test:
    desc: ðŸ§ª test lool
    cmds:
      - cargo nextest run --all-features

  release:patch:
    desc: ðŸš€ release Â«patchÂ» version of lool
    deps:
        - release:pre
    cmds:
        - cargo release patch --execute --no-confirm
  
  release:minor:
    desc: ðŸš€ release Â«minorÂ» version of lool
    deps:
        - release:pre
    cmds:
        - cargo release minor --execute --no-confirm

  release:major:
    desc: ðŸš€ release Â«majorÂ» version of lool
    deps:
        - release:pre
    cmds:
        - cargo release major --execute --no-confirm

  release:pre:
    desc: ðŸš€ prerelease rustler-core
    deps:
        - fmt:check
        - lint:check

  release:
      aliases:
        - "publish"
      desc: ðŸš€ release Â«patchÂ» version of lool
      deps:
          - release:pre
      cmds:
          - cargo release patch --execute